{
  "$schema": "http://json-schema.org/draft-07/schema#",

  "definitions": {
    "common": {
      "properties": {
        "a1": { "type": "string" },
        "a2": { "type": "number" }
      }
    },

    "simple": {
      "type": "object",
      "allOf": [
        {
          "$ref": "#/definitions/common",
          "additionalProperties": false
        }
      ]
    },

    "extended": {
      "type": "object",
      "allOf": [
        {
          "$ref": "#/definitions/common"
        },
        {
          "properties": {
            "a3": { "type": "string" }
          },
          "additionalProperties": true
        }
      ],
      "properties": {
        "a1": {},
        "a2": {},
        "a3": {}
      },
      "additionalProperties": false,
      "required": ["a1"]
    }
  },

  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "simple": { "$ref": "#/definitions/simple" },
      "extended": { "$ref": "#/definitions/extended" },
      "aaa": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "a1": { "type": "string" },
            "a2": { "type": "string" }
          },
          "default": [{ "a1": "XXX" }]
        }
      }
    }
  }
}
